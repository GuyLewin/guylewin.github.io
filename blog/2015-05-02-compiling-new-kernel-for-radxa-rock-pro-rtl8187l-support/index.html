<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><link href=https://guylewin.com/rss.xml rel=alternate title=RSS type=application/rss+xml><title>Guy Lewin's Blog | Compiling Kernel for Radxa Rock Pro (+ rtl8187l support)</title><link as=style href=https://guylewin.com/css/style.css rel=preload><link crossorigin href=https://raw.githack.com/Speyll/suCSS/main/reset-min.css rel=stylesheet><link crossorigin href=https://raw.githack.com/Speyll/suCSS/main/suCSS-min.css rel=stylesheet><link href=https://guylewin.com/css/style.css rel=stylesheet><link href=https://guylewin.com/css/custom.css rel=stylesheet><link href=https://guylewin.com/favicon.ico rel=icon><script src="https://www.googletagmanager.com/gtag/js?id=G-YEJ89F03YG" async></script><script>window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-YEJ89F03YG');</script><meta content="Step-by-step guide for compiling the upstream Linux kernel for Radxa Rock Pro device with rtl8187l wireless adapter support, including configuration and compilation instructions." name=description><meta content="Step-by-step guide for compiling the upstream Linux kernel for Radxa Rock Pro device with rtl8187l wireless adapter support, including configuration and compilation instructions." property=og:description><meta content="Step-by-step guide for compiling the upstream Linux kernel for Radxa Rock Pro device with rtl8187l wireless adapter support, including configuration and compilation instructions." name=twitter:description><meta content="kernel, linux, radxa rock pro, rock pro, rtl8187l" name=keywords><meta content=Zola name=generator><meta content=English name=language><meta content="index, follow" name=robots><meta content="index, follow" name=googlebot><meta content=en_US property=og:locale><meta content="Guy Lewin's Blog" property=og:site_name><meta content="Guy Lewin's Blog | Compiling Kernel for Radxa Rock Pro (+ rtl8187l support)" property=og:title><meta content=https://guylewin.com/blog/2015-05-02-compiling-new-kernel-for-radxa-rock-pro-rtl8187l-support/ property=og:url><meta content=article property=og:type><meta content=summary_large_image name=twitter:card><meta content="Guy Lewin's Blog | Compiling Kernel for Radxa Rock Pro (+ rtl8187l support)" name=twitter:title><link href=https://guylewin.com/blog/2015-05-02-compiling-new-kernel-for-radxa-rock-pro-rtl8187l-support/ rel=canonical><meta content="Guy Lewin" name=author><meta content="Guy Lewin" property=og:author><meta content=2015-05-02T00:00:00Z property=article:published_time><meta content="Guy Lewin" property=article:author><meta content=Blog property=article:section><meta content=kernel property=article:tag><meta content=linux property=article:tag><meta content="radxa rock pro" property=article:tag><meta content="rock pro" property=article:tag><meta content=rtl8187l property=article:tag><script type=application/ld+json>
{
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "Compiling Kernel for Radxa Rock Pro (+ rtl8187l support)",
    
    "author": {
        "@type": "Person",
        "name": "Guy Lewin"
    },
    
    
    "datePublished": "2015-05-02",
    
    "description": "Step-by-step guide for compiling the upstream Linux kernel for Radxa Rock Pro device with rtl8187l wireless adapter support, including configuration and compilation instructions.",
    "publisher": {
        "@type": "Organization",
        "name": "Guy Lewin&#x27;s Blog"
    }
}
</script><body><nav id=nav-bar><div class=nav-social><a class=icon-link href=https://www.threads.com/@guylewin target=_blank><svg class=icon><use href=https://guylewin.com/icons.svg#threads></use></svg></a><a class=icon-link href=https://www.linkedin.com/in/guy-lewin-48b00712 target=_blank><svg class=icon><use href=https://guylewin.com/icons.svg#linkedin></use></svg></a><a class=icon-link href=https://github.com/GuyLewin target=_blank><svg class=icon><use href=https://guylewin.com/icons.svg#github></use></svg></a><a class=icon-link href=mailto:contact@guylewin.com target=_blank><svg class=icon><use href=https://guylewin.com/icons.svg#email></use></svg></a></div><div class=nav-menu><a href=/> /blog/ </a><a href=/about> /about/ </a></div><div class=nav-controls><div aria-label="Toggle theme" class=theme-toggle data-icon-base=https://guylewin.com/icons.svg data-icon-dark=#darkMode data-icon-light=#lightMode data-sound-src=https://guylewin.com/click.ogg id=theme-toggle role=button tabindex=0><svg class=icon><use id=theme-icon></use></svg></div></div></nav><main><article class=post><header class=post-header><time datetime=2015-05-02>Published on: <span class=accent-data>2015-05-02</span> </time><address rel=author>By <span class=accent-data>Guy Lewin</span></address><h1>Compiling Kernel for Radxa Rock Pro (+ rtl8187l support)</h1></header><div class=post-content><p>In the past few weeks Iâ€™ve been struggling to compile a kernel module for the Radxa Rock Pro, and ended up compiling the upstream kernel manually while configuring it to support my module.<p>Since it took much longer than I expected (mainly because of unexpected problems I wish I had known before I took this project), I decided to make a post describing my adventures with this wonderful device (and yes, I had to open a new blog to do that ðŸ™ƒ).<p>In this blog post I will try to describe the steps I had to make, including download links, of configuring, compiling and loading the upstream Linux kernel for the Radxa Rock Pro device.<p>When youâ€™re done following this post, you should end up with a Rock Pro with the 3.18.11 Linux kernel, that loads itâ€™s rootfs from the MicroSD card. <strong>Note that as far as I know, Rock Proâ€™s HDMI output is not supported on these new kernels (it didnâ€™t work for me as well), so be sure you want donâ€™t need your HDMI output before following this post.</strong><p>Disclaimer: Most of the information in this post is taken from online posts, mainly from the <a rel="noopener external" href=http://radxa.com/Rock/Linux_Mainline target=_blank>Radxa wiki</a> and <a rel="noopener external" href=http://www.cnx-software.com/2014/01/27/getting-started-with-raxda-rock-how-to-generate-and-flash-ubuntu-saucy-server-and-desktop-images/ target=_blank>CNX-Software blog</a>. This post is just my attempt of simplifying all of the online information, and documenting / solving some issues I had when I tried to follow the online instructions.<h2 id=alfa-awus036h>ALFA AWUS036H</h2><p><img alt src=/images/posts/compiling-new-kernel-for-radxa-rock-pro-rtl8187l-support/1.jpg> My target was to make the Radxa Rock Pro support ALFA AWUS036Hâ€™s monitor mode, and later on - airodump-ng and other similar tools. Sound simple!<p>Since I had never heard of this network device until I started this project, I looked it up online and saw it is based on the famous Realtek RTL8187L chipset. Searching online also brought up that I should make the rtl8187l driver run on my Rock Pro device, and Iâ€™ll be done with this project.<p>However, in order to compile a kernel module, I must have the running kernel + itâ€™s configuration, and make sure it supports the Linux features required for the module to work (in this case - WIRELESS_EXT, MAC80211, â€¦). After a few days of trying to compile the module with the pre-installed Radxa kernel from their site (3.0.36+ - <a rel="noopener external" href=https://github.com/radxa/linux-rockchip target=_blank>https://github.com/radxa/linux-rockchip</a>), I realised that I must use the upstream kernel, that already contains official rtl8187l module support, with my own configuration.<h2 id=pre-requirements>Pre-Requirements</h2><ul><li>Radxa Rock Pro<li>MicroSD Card (8GB+)</ul><p>As the Radxa wiki says, you must own a Ubuntu 14.10 (or newer) Linux for the compilation process, along with GCC 4.9 or newer. When I tried to compile without these, I get an error from the precompiler stating that my compiler (GCC 4.8) has known issues when compiling the kernel, and that I should upgrade.<p>Of course, since we are compiling for the Radxa Rock Pro, you also need an environment including a cross compiler. You also need parted when creating the SD card image, and build-essential + libusb for rkflashtool. Run this installation line to install all dependencies before we start:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> apt-get install build-essential gcc-arm-linux-gnueabihf lzop libncurses5-dev libssl-dev bc parted build-essential libusb-1.0-0-de</span></span></code></pre><h2 id=kernel-source>Kernel Source</h2><p>The Radxa wiki states you should clone the linux-next git repository and compile it for the Rock Pro. When I tried to do so and follow their steps - the compilation failed since the configuration was too old.<p><strong>Therefore, I recommend using the Linux 3.18.11 kernel, it worked out-of-the-box and didnâ€™t require any code changes.</strong> You can get it by running:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>wget</span><span style=color:#9ecbff> https://www.kernel.org/pub/linux/kernel/v3.x/linux-3.18.11.tar.xz</span></span>
<span class=giallo-l><span style=color:#b392f0>tar</span><span style=color:#9ecbff> xf linux-3.18.11.tar.xz</span></span>
<span class=giallo-l><span style=color:#79b8ff>cd</span><span style=color:#9ecbff> linux-3.18.11</span></span></code></pre><p>After extracting the kernel, you should download the default Rock Pro configuration along with the .dts file, that will be used when booting (again, taken from Wiki):<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>wget</span><span style=color:#9ecbff> http://rockchip.fr/radxa/linux/rockchip_defconfig</span><span style=color:#79b8ff> -O</span><span style=color:#9ecbff> arch/arm/configs/rockchip_defconfig</span></span>
<span class=giallo-l><span style=color:#b392f0>wget</span><span style=color:#9ecbff> http://rockchip.fr/radxa/linux/rk3188-radxarock.dts</span><span style=color:#79b8ff> -O</span><span style=color:#9ecbff> arch/arm/boot/dts/rk3188-radxarock.dts</span></span></code></pre><h2 id=build-environment-configuration>Build Environment Configuration</h2><p>Before we start to mess with kernel compilations, we should make sure to always use the cross-compiler environment suitable for our device.<br> Run the following <strong>in each terminal you use in the compilation process</strong> to set the build environment:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#f97583>export</span><span> ARCH</span><span style=color:#f97583>=</span><span>arm</span></span>
<span class=giallo-l><span style=color:#f97583>export</span><span> CROSS_COMPILE</span><span style=color:#f97583>=</span><span>arm-linux-gnueabihf-</span></span></code></pre><h2 id=configuring-kernel>Configuring Kernel</h2><p>Copy the default Rock Pro configuration to the current configuration location:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>cp</span><span style=color:#9ecbff> arch/arm/configs/rockchip_defconfig .config</span></span></code></pre><p>And configure the kernel as youâ€™d like by running:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>make</span><span style=color:#9ecbff> menuconfig</span></span></code></pre><p>(the menuconfig will use the .config we copied as the base for your changes). Since Iâ€™m describing my efforts to add support for the rtl8187l kernel module, the things I had to enable in the Kernel configuration are the following <strong>(the order is important!)</strong>:<p><em>(You should navigate the menuconfig with the arrow keys and the space bar for selection. When selecting a feature, you can either mark it as built in &lt;*>, kernel module &lt;M> or unselected feature that will not be present in the kernel &lt; >)</em><ul><li>Networking support -> Wireless -> Generic IEEE 802.11 Networking Stack (mac802111) (NEW) - <strong>set this to have &lt;*> on the side (built-in kernel support)</strong><li>Device Drivers -> Network device support -> Wireless LAN -> Realtek 8187 and 8187B USB support - <strong>set this to have &lt;M> on the side (kernel module)</strong></ul><p>Exit the menuconfig and choose &lt; Yes > when asked whether to save the new configuration.<p>The message <em>"configuration written to .config"</em> should appear after saving. Now itâ€™s time to compile our new configuration.<h2 id=compiling-the-kernel-modules>Compiling the Kernel + Modules</h2><p>Run the following commands:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>make</span><span style=color:#9ecbff> prepare</span></span>
<span class=giallo-l><span style=color:#b392f0>make</span><span style=color:#79b8ff> -j8</span><span style=color:#9ecbff> zImage dtbs</span></span></code></pre><p>This will create 2 necessary files, zImage (the compressed kernel) and rk3188-radxarock.dtb (device tree blob, used at the Rock Pro boot).<p>Now letâ€™s compile the modules for later use:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>mkdir</span><span style=color:#9ecbff> modules</span></span>
<span class=giallo-l><span style=color:#f97583>export</span><span> INSTALL_MOD_PATH</span><span style=color:#f97583>=</span><span>./modules</span></span>
<span class=giallo-l><span style=color:#b392f0>make</span><span style=color:#9ecbff> modules</span></span>
<span class=giallo-l><span style=color:#b392f0>make</span><span style=color:#9ecbff> modules_install</span></span></code></pre><p>Now the "modules" directory is full with compiled kernel modules. We will use it later to build our SD card image.<h2 id=creating-boot-img>Creating boot.img</h2><p>Run the following commands to install Radxa mkbootimg:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>git</span><span style=color:#9ecbff> clone https://github.com/neo-technologies/rockchip-mkbootimg.git</span></span>
<span class=giallo-l><span style=color:#79b8ff>cd</span><span style=color:#9ecbff> rockchip-mkbootimg</span></span>
<span class=giallo-l><span style=color:#b392f0>make</span></span>
<span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> make install</span></span>
<span class=giallo-l><span style=color:#79b8ff>cd</span><span style=color:#9ecbff> ..</span></span></code></pre><p>According to the wiki, we need to append the device tree blob to zImage (CONFIG_ARM_APPENDED_DTB option) until we can use U-Boot device tree support:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>cat</span><span style=color:#9ecbff> arch/arm/boot/zImage arch/arm/boot/dts/rk3188-radxarock.dtb</span><span style=color:#f97583> ></span><span style=color:#9ecbff> zImage-dtb</span></span></code></pre><p>And after we have everything ready, make the boot.img out of the zImage-dtb:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>mkbootimg</span><span style=color:#79b8ff> --kernel</span><span style=color:#9ecbff> zImage-dtb</span><span style=color:#79b8ff> --ramdisk</span><span style=color:#9ecbff> /dev/null</span><span style=color:#79b8ff> -o</span><span style=color:#9ecbff> boot.img</span></span></code></pre><p>My working & ready boot.img is available for download <a rel="noopener external" href=https://dl.dropboxusercontent.com/u/3819031/boot.img target=_blank>here</a>.<h2 id=preparing-sd-card-image>Preparing SD Card Image</h2><p>When weâ€™ll flash the kernel onto the Rock Pro, it will load and try to load the linux rootfs from the MicroSD card (youâ€™ll see, when itâ€™s part of the configuration that will be flashed in the next few steps).<p>Therefore we should make an SD card image ready with all of the compatible binaries and the modules we have compiled earlier, including the rtl8187l module.<p>To do that, we should start with an already ready SD card image, mount itâ€™s ext4 partition locally on our Ubuntu and insert the kernel modules we built before.<p>I used <a rel="noopener external" href=http://dl.radxa.com/rock_pro/images/ubuntu/sd/radxa_rock_pro_ubuntu_14.04_server_k318rc5_141129_sdcard.zip target=_blank>this</a> SD card image and did the following:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#79b8ff>cd</span><span style=color:#9ecbff> ..</span></span>
<span class=giallo-l><span style=color:#b392f0>wget</span><span style=color:#9ecbff> http://dl.radxa.com/rock_pro/images/ubuntu/sd/radxa_rock_pro_ubuntu_14.04_server_k318rc5_141129_sdcard.zip</span></span>
<span class=giallo-l><span style=color:#b392f0>unzip</span><span style=color:#9ecbff> radxa_rock_pro_ubuntu_14.04_server_k318rc5_141129_sdcard.zip</span></span></code></pre><p>After having the SD Card .img file, we need to find out where itâ€™s ext4 partition starts in order to load it to our Ubuntu. We will do it using "parted" we installed in the pre-requirements:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>parted</span><span style=color:#9ecbff> radxa_rock_pro_ubuntu_14.04_server_k318rc5_141129_sdcard.img</span></span>
<span class=giallo-l><span style=color:#b392f0>unit</span><span style=color:#9ecbff> B</span></span>
<span class=giallo-l><span style=color:#79b8ff>print</span></span>
<span class=giallo-l><span style=color:#b392f0>quit</span></span></code></pre><p>You should see a table containing the start offset of the ext4 partition, which looks kind of like this:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=plain><span class=giallo-l><span>Number Start End Size Type File system Flags  </span></span>
<span class=giallo-l><span>1 33554432B 1082130431B 1048576000B primary ext4</span></span></code></pre><p>Use the start number we found before to mount the ext4 partition:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>mkdir</span><span style=color:#9ecbff> ubuntu_sdcard</span></span>
<span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> mount</span><span style=color:#79b8ff> -o</span><span style=color:#9ecbff> offset=</span><span style=color:#79b8ff>33554432</span><span style=color:#9ecbff> radxa_rock_pro_ubuntu_14.04_server_k318rc5_141129_sdcard.img ubuntu_sdcard</span></span></code></pre><p>If everything went well, ubuntu_sdcard now points to the ext4 partition in the SD card image file. We should now copy the modules and firmware into the ext4 partition:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> mkdir ./ubuntu_sdcard/lib/modules</span></span>
<span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> cp</span><span style=color:#79b8ff> -r</span><span style=color:#9ecbff> linux-3.18.11/modules/lib/modules/3.18.11/ ./ubuntu_sdcard/lib/modules</span></span>
<span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> mkdir ./ubuntu_sdcard/lib/firmware</span></span>
<span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> cp</span><span style=color:#79b8ff> -r</span><span style=color:#9ecbff> linux-3.18.11/firmware/</span><span style=color:#79b8ff>*</span><span style=color:#9ecbff> ./ubuntu_sdcard/lib/firmware/</span></span></code></pre><p>Also, CNX-Software suggested (and I agree) to configure DHCP to the Ethernet port on boot:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> vi ./ubuntu_sdcard/etc/network/interfaces</span></span></code></pre><p>And add the following 2 lines:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=plain><span class=giallo-l><span>auto eth0 iface eth0 inet dhcp</span></span></code></pre><p>Also, CNX-Software claims you need a script to detect rootfs at boot time. I used it, donâ€™t know if it matters:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> vi ./ubuntu_sdcard/usr/local/bin/mtd-by-name.sh</span></span></code></pre><p>And copy the following into the file:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#6a737d>#!/bin/sh -e</span></span>
<span class=giallo-l><span style=color:#6a737d># mtd-by-name link the mtdblock to name</span></span>
<span class=giallo-l><span style=color:#6a737d># radxa.com, thanks to naobsd</span></span>
<span class=giallo-l><span style=color:#b392f0>rm</span><span style=color:#79b8ff> -rf</span><span style=color:#9ecbff> /dev/block/mtd/by-name/</span></span>
<span class=giallo-l><span style=color:#b392f0>mkdir</span><span style=color:#79b8ff> -p</span><span style=color:#9ecbff> /dev/block/mtd/by-name</span></span>
<span class=giallo-l><span style=color:#f97583>for</span><span> i</span><span style=color:#f97583> in</span><span style=color:#9ecbff> `</span><span style=color:#b392f0>ls</span><span style=color:#79b8ff> -d</span><span style=color:#9ecbff> /sys/class/mtd/mtd</span><span style=color:#79b8ff>*</span><span style=color:#9ecbff>[0-9]`</span><span>;</span><span style=color:#f97583> do</span></span>
<span class=giallo-l><span>    name</span><span style=color:#f97583>=</span><span style=color:#9ecbff>`</span><span style=color:#b392f0>cat</span><span> $i</span><span style=color:#9ecbff>/name`</span></span>
<span class=giallo-l><span>    tmp</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"`</span><span style=color:#79b8ff>echo</span><span> $i</span><span style=color:#f97583> |</span><span style=color:#b392f0> sed</span><span style=color:#79b8ff> -e</span><span style=color:#9ecbff> 's/mtd/mtdblock/g'`"</span></span>
<span class=giallo-l><span>    dev</span><span style=color:#f97583>=</span><span style=color:#9ecbff>"`</span><span style=color:#79b8ff>echo</span><span> $tmp</span><span style=color:#f97583> |</span><span style=color:#b392f0>sed</span><span style=color:#79b8ff> -e</span><span style=color:#9ecbff> 's/\/sys\/class\/mtdblock/\/dev/g'`"</span></span>
<span class=giallo-l><span style=color:#b392f0>    ln</span><span style=color:#79b8ff> -s</span><span> $dev</span><span style=color:#9ecbff> /dev/block/mtd/by-name/</span><span>$name</span></span>
<span class=giallo-l><span style=color:#f97583>done</span></span></code></pre><p>Make sure the script is executable and edit the startup script:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> chmod +x ./ubuntu_sdcard/usr/local/bin/mtd-by-name.sh</span></span>
<span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> vi ./ubuntu_sdcard/etc/rc.local</span></span></code></pre><p>And add the line below before <em>exit 0:</em><pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>/usr/local/bin/mtd-by-name.sh</span></span></code></pre><p>Thatâ€™s it. Letâ€™s unmount the ext4 partition:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> umount ./ubuntu_sdcard/</span></span></code></pre><p>And radxa_rock_pro_ubuntu_14.04_server_k318rc5_141129_sdcard.img should now contain your new files! You can download my compiled version <a rel="noopener external" href=https://dl.dropboxusercontent.com/u/3819031/radxa_rock_pro_ubuntu_14.04_server_k3.18.11_150502_guylewin_sdcard.rar target=_blank>here</a>.<h2 id=flashing-sd-card-image>Flashing SD Card Image</h2><p>To flash the newly created image, you should use <a rel="noopener external" href=http://sourceforge.net/projects/win32diskimager/ target=_blank>Win32DiskImager</a> if youâ€™re on Windows (simply follow the GUI).<p>If youâ€™re on Linux / OS X, you can use the dd command using this syntax (replace <em>/dev/sdc</em> with your SD card writer device):<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> dd if=radxa_rock_pro_ubuntu_14.04_server_k318rc5_141129_sdcard.img of=/dev/sdc</span></span></code></pre><p>Now take out your MicroSD card and put it in the Rock Pro. It will be necessary for boot after we flash the device.<h2 id=flashing-the-kernel>Flashing the Kernel</h2><p>Connect the device to your computer via USB, and follow <a rel="noopener external" href=http://radxa.com/Rock/Loader_mode target=_blank>these instructions</a> to bring the Rock Pro to loader mode.<p>Get the parameter file describing kernel parameters by:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>wget</span><span style=color:#9ecbff> http://dl.radxa.com/rock/images/parameter/parameter_linux_sd</span></span></code></pre><p>Install rkflashtool to flash the Rock Pro:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>git</span><span style=color:#9ecbff> clone https://github.com/linux-rockchip/rkflashtool</span></span>
<span class=giallo-l><span style=color:#79b8ff>cd</span><span style=color:#9ecbff> rkflashtool</span></span>
<span class=giallo-l><span style=color:#b392f0>make</span></span>
<span class=giallo-l><span style=color:#b392f0>sudo</span><span style=color:#9ecbff> cp rkflashtool rkcrc rkunpack rkunsign /usr/local/bin</span></span></code></pre><p>And use it to flash boot.img and restart the device:<pre class=giallo style=color:#e1e4e8;background-color:#24292e><code data-lang=shellscript><span class=giallo-l><span style=color:#b392f0>rkflashtool</span><span style=color:#9ecbff> P</span><span style=color:#f97583> &lt;</span><span style=color:#9ecbff> parameter_linux_sd</span></span>
<span class=giallo-l><span style=color:#b392f0>rkflashtool</span><span style=color:#9ecbff> w boot</span><span style=color:#f97583> &lt;</span><span style=color:#9ecbff> boot.img rkflashtool b</span></span></code></pre><p>Your device should now reboot into itâ€™s new kernel, with rtl8187 support.<p>And thatâ€™s it! If you have any questions, fixes, etc, feel free to contact me / comment.</div><div class=post-tags><a class=tag href=/tags/kernel>#kernel</a><a class=tag href=/tags/linux>#linux</a><a class=tag href=/tags/radxa-rock-pro>#radxa rock pro</a><a class=tag href=/tags/rock-pro>#rock pro</a><a class=tag href=/tags/rtl8187l>#rtl8187l</a></div><div class=post-nav><a class=previous href=https://guylewin.com/blog/2015-05-08-as3992-python-api/><svg class=icon><use href=https://guylewin.com/icons.svg#chevronLeft></use></svg> Next Project</a></div></article></main><footer><hr><div id=footer-container><p>Made using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> Zola theme</div></footer><script defer src=https://guylewin.com/js/script.js></script>